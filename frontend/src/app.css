@tailwind base;
@tailwind components;
@tailwind utilities;

/* Base styles */
@layer base {
	html {
		font-family: 'Inter', 'Outfit', system-ui, sans-serif;
	}

	body {
		min-height: 100vh;
		min-height: 100dvh;
		/* Disable native pull-to-refresh on mobile Chrome */
		overscroll-behavior-y: none;
	}

	/* Custom scrollbar */
	::-webkit-scrollbar {
		width: 6px;
		height: 6px;
	}

	::-webkit-scrollbar-track {
		background: transparent;
	}

	::-webkit-scrollbar-thumb {
		background: rgba(255, 255, 255, 0.2);
		border-radius: 3px;
	}

	::-webkit-scrollbar-thumb:hover {
		background: rgba(255, 255, 255, 0.3);
	}
}

/* Component utilities */
@layer components {
	/* Icon button - compact */
	.btn-icon {
		@apply rounded-lg p-2 text-neutral-400 transition-colors duration-150 hover:bg-neutral-800 hover:text-neutral-200 focus:outline-none focus:ring-2 focus:ring-primary-500/50 active:bg-neutral-700;
	}

	/* Input styles */
	.input {
		@apply w-full rounded-xl border border-neutral-700 bg-neutral-900 px-4 py-3 text-neutral-200 transition-all duration-150 placeholder:text-neutral-500 focus:border-primary-500 focus:bg-neutral-800 focus:outline-none focus:ring-2 focus:ring-primary-500/20 disabled:cursor-not-allowed disabled:border-neutral-800 disabled:bg-neutral-950 disabled:text-neutral-600;
	}

	/* Input error state */
	.input-error {
		@apply border-error-500 focus:border-error-500 focus:ring-error-500/20;
	}

	/* Expandable input - base styles for use with expandable action */
	.input-expandable {
		@apply input;
		resize: none;
	}

	/* Label styles */
	.label {
		@apply mb-2 block text-body-sm font-medium text-neutral-300;
	}

	/* Label chip / badge styles */
	.label-chip {
		@apply cursor-pointer rounded-lg border border-neutral-700 bg-neutral-900 px-3 py-1.5 text-sm text-neutral-300 transition-all duration-150 hover:border-neutral-600 hover:bg-neutral-800;
	}

	.label-chip-selected {
		@apply rounded-lg border-2 border-primary-500 bg-primary-500/20 px-3 py-1.5 text-sm font-medium text-primary-300 shadow-sm ring-2 ring-primary-500/20;
	}
}

/* Animation utilities */
@layer utilities {
	.animate-in {
		animation:
			fadeIn 0.25s ease-out,
			slideUp 0.25s ease-out;
	}

	/* Avoid double-animations: disable per-page animate-in when View Transitions are enabled */
	.vt-enabled .animate-in {
		animation: none !important;
	}

	/*
	 * Note: View Transitions already block interaction during page transitions,
	 * so we don't need additional pointer-events manipulation here.
	 * The previous implementation was blocking button clicks on touch devices.
	 */

	.glass {
		@apply bg-neutral-900/80 backdrop-blur-lg;
	}

	/* iOS safe area padding for bottom navigation */
	.pb-safe {
		padding-bottom: env(safe-area-inset-bottom, 0px);
	}

	/* iOS safe area padding for top status bar */
	.pt-safe {
		padding-top: env(safe-area-inset-top, 0px);
	}

	/* Position above bottom navigation with safe area */
	.bottom-nav-offset {
		/* Height of bottom nav (h-16 = 4rem) + iOS safe area */
		bottom: calc(4rem + env(safe-area-inset-bottom, 0px));
		/* Ensure proper stacking and prevent layout shifts on iOS Safari */
		transform: translateZ(0);
		-webkit-transform: translateZ(0);
	}

	/* Skeleton loading animation */
	.skeleton {
		@apply animate-shimmer rounded bg-neutral-800;
		background: linear-gradient(
			90deg,
			theme('colors.neutral.800') 25%,
			theme('colors.neutral.700') 50%,
			theme('colors.neutral.800') 75%
		);
		background-size: 200% 100%;
	}

	/* Stagger animation delays for lists */
	.stagger-1 {
		animation-delay: 0.05s;
	}

	.stagger-2 {
		animation-delay: 0.1s;
	}

	.stagger-3 {
		animation-delay: 0.15s;
	}

	.stagger-4 {
		animation-delay: 0.2s;
	}

	.stagger-5 {
		animation-delay: 0.25s;
	}

	.stagger-6 {
		animation-delay: 0.3s;
	}

	.stagger-7 {
		animation-delay: 0.35s;
	}

	.stagger-8 {
		animation-delay: 0.4s;
	}

	/* Stagger animation with fade in */
	.animate-stagger {
		opacity: 0;
		animation: fadeSlideIn 0.3s ease-out forwards;
	}

	/* Checkmark draw animation for success pages */
	.checkmark-draw {
		stroke-dasharray: 50;
		stroke-dashoffset: 50;
		animation: drawCheck 0.4s ease-out 0.2s forwards;
	}

	/* Success circle scale in */
	.success-scale {
		transform: scale(0);
		animation: scaleIn 0.3s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
	}

	/* Success badge animation */
	.success-badge {
		animation: scaleIn 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
		z-index: 10;
	}

	/* Page container with bottom nav offset */
	.page-content {
		@apply animate-in pb-28;
	}

	/* Fixed bottom panel above nav */
	.fixed-bottom-panel {
		@apply bottom-nav-offset fixed left-0 right-0 z-40 border-t border-neutral-800 bg-neutral-950/95 backdrop-blur-lg;
	}

	/* Empty state container */
	.empty-state {
		@apply flex min-h-[35vh] flex-col items-center justify-center px-6 py-12 text-center;
	}
}

/* Custom keyframes */
@keyframes fadeSlideIn {
	from {
		opacity: 0;
		transform: translateY(10px);
	}

	to {
		opacity: 1;
		transform: translateY(0);
	}
}

@keyframes drawCheck {
	to {
		stroke-dashoffset: 0;
	}
}

@keyframes scaleIn {
	to {
		transform: scale(1);
	}
}

/* ==========================================================================
   Page transitions (View Transitions API)
   Progressive enhancement: only used by browsers that implement the API.
   ========================================================================== */

@media (prefers-reduced-motion: reduce) {
	::view-transition-old(root),
	::view-transition-new(root) {
		animation: none;
	}
}

@media (prefers-reduced-motion: no-preference) {
	::view-transition-old(root) {
		animation: vt-fade-out 180ms ease-out both;
	}

	::view-transition-new(root) {
		animation: vt-fade-in 180ms ease-out both;
	}

	/* Keep fixed UI elements stable during page transitions - no animation */
	/* We hide the old snapshot entirely because backdrop-blur effects can't be 
	   captured properly in View Transition snapshots, causing a "white flash" */
	::view-transition-old(header),
	::view-transition-old(bottom-nav) {
		display: none;
	}

	::view-transition-new(header),
	::view-transition-new(bottom-nav) {
		animation: none;
	}
}

@keyframes vt-fade-in {
	from {
		opacity: 0;
		transform: translateY(6px);
	}

	to {
		opacity: 1;
		transform: translateY(0);
	}
}

@keyframes vt-fade-out {
	from {
		opacity: 1;
		transform: translateY(0);
	}

	to {
		opacity: 0;
		transform: translateY(-6px);
	}
}
